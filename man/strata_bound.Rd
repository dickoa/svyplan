% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/strata_bound.R
\name{strata_bound}
\alias{strata_bound}
\title{Optimal Strata Boundaries}
\usage{
strata_bound(
  x,
  n_strata = 3L,
  n = NULL,
  cv = NULL,
  method = "lh",
  alloc = "neyman",
  cost = NULL,
  certain = NULL,
  nclass = NULL,
  maxiter = 200L,
  niter = NULL
)
}
\arguments{
\item{x}{Numeric vector: stratification variable values. Must not
contain \code{NA}.}

\item{n_strata}{Integer: number of strata (including take-all if
\code{certain} is specified). Must be >= 2.}

\item{n}{Target total sample size. Specify at most one of \code{n} or \code{cv}.
Required for methods \code{"lh"} and \code{"kozak"}.}

\item{cv}{Target coefficient of variation. Specify at most one of \code{n}
or \code{cv}. Required for methods \code{"lh"} and \code{"kozak"}.}

\item{method}{Stratification method: \code{"cumrootf"} (Dalenius-Hodges),
\code{"geo"} (geometric), \code{"lh"} (Lavallée-Hidiroglou), or \code{"kozak"}
(random search). Default \code{"lh"}.}

\item{alloc}{Allocation rule: \code{"proportional"}, \code{"neyman"},
\code{"optimal"}, or a list with components \code{q1}, \code{q2}, \code{q3} for power
allocation. Default \code{"neyman"}.}

\item{cost}{Per-stratum unit costs. Scalar or vector of length
\code{n_strata}. Default \code{NULL} (equal costs).}

\item{certain}{Take-all threshold. Units with \code{x >= certain} form a
census stratum.}

\item{nclass}{Number of histogram bins for \code{"cumrootf"}. Default
\code{NULL} (Freedman-Diaconis rule).}

\item{maxiter}{Maximum iterations for \code{"lh"} and \code{"kozak"}. Default
200.}

\item{niter}{Random restarts for \code{"kozak"}. Default \code{NULL} (= 10 *
\code{n_strata}).}
}
\value{
A \code{svyplan_strata} object with components:
\describe{
\item{boundaries}{Numeric vector of cutpoints (length \code{n_strata - 1}).}
\item{n_strata}{Number of strata.}
\item{n}{Total sample size.}
\item{cv}{Achieved coefficient of variation.}
\item{strata}{Data frame with per-stratum summaries.}
\item{method}{Algorithm used.}
\item{alloc}{Allocation parameters as a list.}
\item{params}{List of additional parameters.}
\item{converged}{Logical (for iterative methods).}
}
}
\description{
Determine where to cut a continuous stratification variable to form
optimal strata. Supports four methods: cumulative root frequency
(Dalenius-Hodges), geometric progression, Lavallée-Hidiroglou
iterative, and Kozak random search.
}
\details{
The four methods differ in approach:
\itemize{
\item \strong{cumrootf}: Dalenius-Hodges (1959) cumulative root frequency rule.
Non-iterative, does not require \code{n} or \code{cv}.
\item \strong{geo}: Gunning-Horgan (2004) geometric progression. Non-iterative,
requires \code{x > 0}.
\item \strong{lh}: Lavallée-Hidiroglou (1988) iterative coordinate-wise
optimization. Requires \code{n} or \code{cv}.
\item \strong{kozak}: Kozak (2004) random search, escapes local minima. Requires
\code{n} or \code{cv}.
}

When \code{n} or \code{cv} is available, \code{"lh"} (the default) directly
minimizes the objective and is fast even on large frames. Use \code{"kozak"}
for highly skewed or multimodal data where coordinate-wise optimization
may get trapped in local minima. The non-iterative methods (\code{"cumrootf"},
\code{"geo"}) are useful for quick exploratory stratification or when neither
\code{n} nor \code{cv} is known yet.

Allocation is controlled by the \code{alloc} parameter via power allocation:
\eqn{n_h \propto N_h^{q_1} S_h^{q_2} / c_h^{q_3}}{n_h ~ N_h^q1 * S_h^q2 / c_h^q3}.
Named shortcuts: \code{"proportional"} = (1, 0, 0), \code{"neyman"} = (1, 1, 0),
\code{"optimal"} = (1, 1, 0.5). Stratum allocations \code{n_h} are rounded to
integers using the ORIC method (Cont and Heidari, 2014), which preserves
\code{sum(n_h) = n} while minimizing rounding distortion.
}
\examples{
set.seed(42)
x <- rlnorm(500, meanlog = 6, sdlog = 1.5)

# Dalenius-Hodges (non-iterative)
strata_bound(x, n_strata = 4, method = "cumrootf", n = 100)

# LH (default, iterative)
strata_bound(x, n_strata = 4, n = 100)

# With take-all stratum
strata_bound(x, n_strata = 3, n = 80, certain = quantile(x, 0.95))

}
\references{
Dalenius, T. and Hodges, J. L. (1959). Minimum variance stratification.
\emph{Journal of the American Statistical Association}, 54(285), 88--101.

Lavallee, P. and Hidiroglou, M. (1988). On the stratification of skewed
populations. \emph{Survey Methodology}, 14(1), 33--43.

Kozak, M. (2004). Optimal stratification using random search method in
agricultural surveys. \emph{Statistics in Transition}, 6(5), 797--806.

Gunning, P. and Horgan, J. M. (2004). A new algorithm for the
construction of stratum boundaries in skewed populations.
\emph{Survey Methodology}, 30(2), 159--166.

Wesolowski, J., Wieczorkowski, R. and Wojciak, W. (2021). Optimality of
the recursive Neyman allocation.
\emph{Journal of Survey Statistics and Methodology}, 10(5), 1263--1275.

Cont, R. and Heidari, M. (2014). Optimal rounding under integer
constraints. \emph{arXiv preprint} arXiv:1501.00014.
}
\seealso{
\link{predict.svyplan_strata} to assign new data to strata.
}
