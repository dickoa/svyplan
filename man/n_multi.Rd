% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/n_multi.R
\name{n_multi}
\alias{n_multi}
\title{Multi-Indicator Sample Size}
\usage{
n_multi(targets, cost = NULL, budget = NULL, m = NULL, joint = FALSE)
}
\arguments{
\item{targets}{Data frame with one row per indicator. See Details for
column specifications.}

\item{cost}{Numeric vector of per-stage costs. \code{NULL} (default) for
simple mode; length 2 or 3 for multistage mode.}

\item{budget}{Total budget (multistage only). Specify exactly one of
\code{cv} targets or \code{budget}.}

\item{m}{Fixed stage-1 sample size (multistage only).}

\item{joint}{Logical. If \code{TRUE}, optimally split a single \code{budget}
across domains to minimize the worst-case CV ratio. Only applies
to multistage budget mode with multiple domains; ignored otherwise.}
}
\value{
A \code{svyplan_n} object (simple mode) or \code{svyplan_cluster} object
(multistage mode).

\strong{Without domains}, the object contains:
\describe{
\item{\code{n}}{Sample size (simple) or named per-stage allocation vector
(multistage, e.g. \code{c(n1 = 80, n2 = 12)}).}
\item{\code{detail}}{Per-indicator results (sample sizes or achieved CVs).}
\item{\code{binding}}{Name or index of the binding (most demanding) indicator.}
\item{\code{targets}}{The input targets data frame.}
}

\strong{With domains}, the object additionally contains:
\describe{
\item{\code{n}}{Maximum per-stage sample size across domains. In simple
mode, a single number; in multistage mode, a named vector
(e.g. \code{c(n1 = 120, n2 = 15)}) giving the conservative
allocation that satisfies all domains.}
\item{\code{domains}}{Data frame with one row per domain, including
domain variable columns, per-stage allocations (\code{n1}, \code{n2}, ...),
and summary columns (\code{.total_n}, \code{.cv}, \code{.cost}, \code{.binding}
for multistage; \code{.n}, \code{.binding} for simple mode).
Use this for stratum-specific allocations.}
\item{\code{total_n}}{Total sample size summed across all domains
(multistage only).}
\item{\code{cost}}{Total cost summed across all domains
(multistage only).}
}
}
\description{
Compute the sample size that satisfies precision requirements for
multiple survey indicators simultaneously. Supports simple (single-stage)
and multistage cluster designs, with optional domain-level planning.
}
\details{
The \code{targets} data frame supports the following columns:

\describe{
\item{\code{name}}{Indicator label (optional).}
\item{\code{p}}{Expected proportion, in (0, 1). One of \code{p} or \code{var} per row.}
\item{\code{var}}{Population variance. One of \code{p} or \code{var} per row.}
\item{\code{mu}}{Population mean. Required when \code{var} is specified with \code{cv}.}
\item{\code{moe}}{Margin of error (simple mode).}
\item{\code{cv}}{Target coefficient of variation (either mode).}
\item{\code{alpha}}{Significance level (default 0.05).}
\item{\code{deff}}{Design effect multiplier (simple mode only, default 1).}
\item{\code{N}}{Population size (simple mode only, default Inf).}
\item{\code{delta1}, \code{delta2}}{Homogeneity measures (multistage).}
\item{\code{rel_var}}{Unit relvariance. If omitted, derived from \code{p} or
\code{var}/\code{mu}.}
\item{\code{k1}, \code{k2}}{Ratio parameters (multistage, default 1).}
}

Any column not in the recognized set is treated as a \strong{domain variable}.
When domain columns are present, optimization runs independently per
domain combination (default), or jointly when \code{joint = TRUE}.

\strong{Simple mode} (\code{cost = NULL}): computes sample size per indicator using
Wald-type formulas, then takes the maximum per domain.

\strong{Multistage mode} (\code{cost} provided): uses analytical reduction.
For each candidate sub-stage allocation, the required stage-1 size is
the maximum across all indicators. The total cost is then minimized
(CV mode) or the worst-case CV ratio is minimized (budget mode) using
numerical optimization.

\strong{Joint budget allocation} (\code{joint = TRUE}): when domains and a budget
are specified, the default (\code{joint = FALSE}) gives each domain the full
budget independently. With \code{joint = TRUE}, a single budget is split
optimally across domains using L-BFGS-B optimization of budget fractions,
minimizing the worst-case CV ratio across all domains.
}
\examples{
# Simple mode: three indicators, take the max
targets <- data.frame(
  name = c("stunting", "vaccination", "anemia"),
  p    = c(0.30, 0.70, 0.10),
  moe  = c(0.05, 0.05, 0.03)
)
n_multi(targets)

# Simple mode with domains
targets_dom <- data.frame(
  name   = rep(c("stunting", "anemia"), each = 2),
  p      = c(0.30, 0.25, 0.10, 0.15),
  moe    = c(0.05, 0.05, 0.03, 0.03),
  region = rep(c("North", "South"), 2)
)
n_multi(targets_dom)

# Two-stage CV mode
targets_cl <- data.frame(
  name   = c("stunting", "anemia"),
  p      = c(0.30, 0.10),
  cv     = c(0.10, 0.15),
  delta1 = c(0.02, 0.05)
)
n_multi(targets_cl, cost = c(500, 50))

# Joint budget allocation across domains
targets_jnt <- data.frame(
  name   = rep(c("stunting", "anemia"), each = 2),
  p      = c(0.30, 0.25, 0.10, 0.15),
  cv     = c(0.10, 0.10, 0.15, 0.15),
  delta1 = c(0.02, 0.03, 0.05, 0.04),
  region = rep(c("Urban", "Rural"), 2)
)
n_multi(targets_jnt, cost = c(500, 50), budget = 100000, joint = TRUE)

}
\references{
Cochran, W. G. (1977). \emph{Sampling Techniques} (3rd ed.). Wiley.

Valliant, R., Dever, J. A., and Kreuter, F. (2018).
\emph{Practical Tools for Designing and Weighting Survey Samples}
(2nd ed.). Springer.
}
\seealso{
\code{\link[=n_prop]{n_prop()}}, \code{\link[=n_mean]{n_mean()}} for single-indicator sizing;
\code{\link[=n_cluster]{n_cluster()}} for single-indicator multistage allocation.
}
