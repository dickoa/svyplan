% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/varcomp.R
\name{varcomp}
\alias{varcomp}
\title{Estimate Variance Components}
\usage{
varcomp(x, ..., data = NULL, stage_id = NULL, prob = NULL)
}
\arguments{
\item{x}{A formula (e.g., \code{income ~ district}) or a numeric vector
of the analysis variable.}

\item{...}{Additional arguments passed to methods.}

\item{data}{A data frame (required for formula interface).}

\item{stage_id}{A list of stage-ID vectors (required for vector interface).
Length determines the number of stage boundaries (stages - 1).}

\item{prob}{First-stage selection probabilities. A one-sided formula
(e.g., \code{~pp}) when using the formula interface, or a numeric vector
for the vector interface. \code{NULL} (default) assumes SRS.}
}
\value{
A \code{svyplan_varcomp} object with components \code{var_between},
\code{var_within}, \code{delta}, \code{k}, \code{rel_var}, and \code{stages}.
}
\description{
Estimate between- and within-stage variance components from frame
data using nested ANOVA decomposition. Supports SRS and PPS
first-stage designs with a formula or vector interface.
}
\details{
The interface is determined by the class of \code{x}:
\itemize{
\item \strong{Formula}: \code{varcomp(income ~ district, data = frame)}. The LHS is
the analysis variable, RHS terms are stage IDs (outermost first).
\item \strong{Numeric vector}: \code{varcomp(y, stage_id = list(cluster_ids))}.
}

When \code{prob} is \code{NULL}, SRS first-stage is assumed. When provided, PPS
variance estimation is used.
}
\examples{
# 2-stage SRS using formula
set.seed(42)
frame <- data.frame(
  income = rnorm(200, 50000, 10000),
  district = rep(1:20, each = 10)
)
vc <- varcomp(income ~ district, data = frame)
vc

# Feed into n_cluster
n_cluster(cost = c(500, 50), delta = vc, budget = 100000)

}
\references{
Valliant, R., Dever, J. A., and Kreuter, F. (2018).
\emph{Practical Tools for Designing and Weighting Survey Samples}
(2nd ed.). Springer. Ch. 9.

Hansen, M. H., Hurwitz, W. N., and Madow, W. G. (1953).
\emph{Sample Survey Methods and Theory} (Vol. I). Wiley.
}
\seealso{
\code{\link[=n_cluster]{n_cluster()}} which accepts a \code{svyplan_varcomp} as \code{delta}.
}
