% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/n_cluster.R
\name{n_cluster}
\alias{n_cluster}
\alias{n_cluster.default}
\alias{n_cluster.svyplan_prec}
\title{Optimal Multistage Cluster Allocation}
\usage{
n_cluster(cost, ...)

\method{n_cluster}{default}(
  cost,
  delta,
  rel_var = 1,
  k = 1,
  cv = NULL,
  budget = NULL,
  n_psu = NULL,
  resp_rate = 1,
  fixed_cost = 0,
  ...
)

\method{n_cluster}{svyplan_prec}(cost, cv = NULL, budget = NULL, ...)
}
\arguments{
\item{cost}{For the default method: numeric vector of per-stage costs.
Length determines the number of stages (2 or 3).
For \code{svyplan_prec} objects: a precision result from \code{\link[=prec_cluster]{prec_cluster()}}.}

\item{...}{Additional arguments passed to methods.}

\item{delta}{Numeric vector of homogeneity measures (length = stages - 1),
or a \code{svyplan_varcomp} object.}

\item{rel_var}{Unit relvariance (default 1).}

\item{k}{Ratio parameter(s). Scalar for 2-stage, length-2 vector for
3-stage (default 1).}

\item{cv}{Target coefficient of variation. Specify exactly one of \code{cv}
or \code{budget}.}

\item{budget}{Total budget. Specify exactly one of \code{cv} or \code{budget}.}

\item{n_psu}{Fixed number of PSUs (stage-1 sample size). \code{NULL} (default)
means optimize all stages.}

\item{resp_rate}{Expected response rate, in (0, 1]. Default 1 (no
adjustment). The stage-1 sample size is inflated by \code{1 / resp_rate}.}

\item{fixed_cost}{Fixed overhead cost (C0). Default 0.
The total cost model becomes
\code{C = C0 + c1*n_psu + c2*n_psu*psu_size [+ c3*n_psu*psu_size*ssu_size]}.
In budget mode, only \code{budget - fixed_cost} is available for variable costs;
in CV mode, \code{fixed_cost} is added to the variable cost.}
}
\value{
A \code{svyplan_cluster} object with components:
\describe{
\item{\code{n}}{Named numeric vector of continuous per-stage sample sizes
(e.g. \code{c(n_psu = 84.1, psu_size = 13.8)}). Use \code{ceiling()} for
operational (integer) values.}
\item{\code{stages}}{Number of stages (2 or 3).}
\item{\code{total_n}}{Continuous total sample size (\code{prod(n)}). Use
\code{as.integer()} for the operational total (product of ceiled stages),
or \code{as.double()} for this continuous value.}
\item{\code{cv}}{Achieved coefficient of variation (based on continuous
optimum).}
\item{\code{cost}}{Total cost.}
\item{\code{params}}{List of input parameters.}
}
}
\description{
Compute optimal per-stage sample sizes for a multistage cluster
design, minimizing cost for a given precision or minimizing
variance for a given budget.
}
\details{
Stage count is determined by \code{length(cost)}. Two dispatch dimensions:
\itemize{
\item \strong{2-stage vs 3-stage} (vector length)
\item \strong{budget vs cv} mode (which is non-NULL)
}

When \code{n_psu} is specified, stage 1 is fixed and only stage 2+ are optimized.

If \code{delta} is a \code{svyplan_varcomp} object, \code{delta}, \code{rel_var}, and \code{k}
are extracted automatically.

These functions assume sampling fractions are negligible at each stage
(equivalent to sampling with replacement). No finite population correction
is applied. This is standard for multistage planning when cluster
populations are large relative to the sample.
}
\examples{
# 2-stage, budget mode
n_cluster(cost = c(500, 50), delta = 0.05, budget = 100000)

# 2-stage, CV mode
n_cluster(cost = c(500, 50), delta = 0.05, cv = 0.05)

# 2-stage, fixed n_psu
n_cluster(cost = c(500, 50), delta = 0.05, budget = 100000, n_psu = 40)

# 3-stage
n_cluster(cost = c(500, 100, 50), delta = c(0.01, 0.05), cv = 0.05)

# With fixed overhead cost
n_cluster(cost = c(500, 50), delta = 0.05, budget = 100000, fixed_cost = 5000)

}
\references{
Valliant, R., Dever, J. A., and Kreuter, F. (2018).
\emph{Practical Tools for Designing and Weighting Survey Samples}
(2nd ed.). Springer. Ch. 9.
}
\seealso{
\code{\link[=prec_cluster]{prec_cluster()}} for the inverse, \code{\link[=varcomp]{varcomp()}} for estimating
variance components.
}
